// What's New package Prisma schema
// Copy these models into your main prisma/schema.prisma file

model WhatsNewEntry {
  id          String    @id @default(cuid())

  date        DateTime
  title       String    @db.VarChar(100)
  summary     String    @db.Text
  content     String?   @db.Text  // Markdown for detailed view

  isPublished Boolean   @default(true)

  // Voting
  upvotes     Int       @default(0)
  downvotes   Int       @default(0)

  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  votes          WhatsNewVote[]
  linkedFeedback WhatsNewFeedbackLink[]

  @@index([date(sort: Desc)])
  @@index([isPublished])
}

model WhatsNewVote {
  id        String   @id @default(cuid())
  entryId   String
  userId    String
  voteType  String   // 'up' | 'down'
  createdAt DateTime @default(now())

  entry     WhatsNewEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@unique([entryId, userId])
  @@index([entryId])
  @@index([userId])
}

model WhatsNewFeedbackLink {
  id         String   @id @default(cuid())
  entryId    String
  feedbackId String
  createdBy  String?
  createdAt  DateTime @default(now())

  entry      WhatsNewEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@unique([entryId, feedbackId])
  @@index([entryId])
  @@index([feedbackId])
}

// Track user's last visit to what's new
model WhatsNewUserVisit {
  id            String   @id @default(cuid())
  userId        String   @unique
  lastVisitedAt DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
}
